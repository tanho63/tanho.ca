---
layout: single
title: "Advent of Code, Day 7"
date:   2020-12-07
summary: "Tackling day seven of Advent of Code - handy haversacks!"
type: rshiny
menu:
  sidebar:
    name: AdventofCode-07
    identifier: adventcode2020-7
    parent: rshiny
url: /adventcode-2020-07
hero: /images/rshiny/advent.jpg
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Day seven! “Handy Haversacks”</p>
<pre class="r"><code>library(tidyverse)
library(here)

knitr::opts_chunk$set(echo = TRUE)</code></pre>
<blockquote>
<p>Due to recent aviation regulations, many rules (your puzzle input) are being enforced about bags and their contents; bags must be color-coded and must contain specific quantities of other color-coded bags. Apparently, nobody responsible for these regulations considered how long they would take to enforce!</p>
<p>For example, consider the following rules:</p>
<ul>
<li>light red bags contain 1 bright white bag, 2 muted yellow bags.</li>
<li>dark orange bags contain 3 bright white bags, 4 muted yellow bags.</li>
<li>bright white bags contain 1 shiny gold bag.</li>
<li>muted yellow bags contain 2 shiny gold bags, 9 faded blue bags.</li>
<li>shiny gold bags contain 1 dark olive bag, 2 vibrant plum bags.</li>
<li>dark olive bags contain 3 faded blue bags, 4 dotted black bags.</li>
<li>vibrant plum bags contain 5 faded blue bags, 6 dotted black bags.</li>
<li>faded blue bags contain no other bags.</li>
<li>dotted black bags contain no other bags.</li>
</ul>
<p>These rules specify the required contents for 9 bag types. In this example, every faded blue bag is empty, every vibrant plum bag contains 11 bags (5 faded blue and 6 dotted black), and so on.</p>
<p>You have a shiny gold bag. If you wanted to carry it in at least one other bag, how many different bag colors would be valid for the outermost bag? (In other words: how many colors can, eventually, contain at least one shiny gold bag?)</p>
<p>In the above rules, the following options would be available to you:</p>
<ul>
<li>A bright white bag, which can hold your shiny gold bag directly.</li>
<li>A muted yellow bag, which can hold your shiny gold bag directly, plus some other bags.</li>
<li>A dark orange bag, which can hold bright white and muted yellow bags, either of which could then hold your shiny gold bag.</li>
<li>A light red bag, which can hold bright white and muted yellow bags, either of which could then hold your shiny gold bag.</li>
</ul>
<p>So, in this example, the number of bag colors that can eventually contain at least one shiny gold bag is 4.</p>
<p>How many bag colors can eventually contain at least one shiny gold bag?</p>
</blockquote>
<div id="data" class="section level3">
<h3>Data</h3>
<pre class="r"><code>input_07 &lt;- read_lines(&quot;https://github.com/tanho63/advent_of_code/raw/master/2020/day-07.txt&quot;)</code></pre>
</div>
<div id="cleaning" class="section level3">
<h3>Cleaning</h3>
<pre class="r"><code>df_rules &lt;- tibble(input = input_07) %&gt;% 
  separate(input,into = c(&quot;name&quot;,&quot;rule&quot;),sep = &quot; bags contain &quot;) %&gt;% 
  mutate(rule = str_split(rule,&quot;bags|bag&quot;)) %&gt;% 
  unnest_longer(rule)  %&gt;% 
  mutate(rule = str_remove(rule,&quot;,&quot;),
         rule = str_remove(rule,&quot;\\.&quot;),
         rule = str_squish(rule)) %&gt;% 
  filter(rule != &quot;&quot;) %&gt;% 
  mutate(rule_qty = parse_number(rule,na = &quot;no other&quot;),
         rule_colour = if_else(is.na(rule_qty), 
                               NA_character_,
                               str_remove(rule,as.character(rule_qty))),
         rule_colour = str_squish(rule_colour))</code></pre>
</div>
<div id="problem-1---how-many-bag-colours-eventually-contain-one-shiny-gold-bag" class="section level3">
<h3>Problem 1 - how many bag colours eventually contain one shiny gold bag?</h3>
<pre class="r"><code>find_parents &lt;- function(colour,df_rules){
  
  x &lt;- df_rules %&gt;% 
    filter(rule_colour == colour, rule_qty &gt;= 1)
  
  map_dfr(x$name,find_parents,df_rules) %&gt;% 
    bind_rows(x,.)
  
}

parents &lt;- find_parents(&quot;shiny gold&quot;,df_rules)

unique(parents$name) %&gt;% length()</code></pre>
<pre><code>## [1] 119</code></pre>
</div>
<div id="problem-2---how-many-bags-are-inside-your-shiny-gold-bag" class="section level3">
<h3>Problem 2 - how many bags are inside your shiny gold bag?</h3>
<p>The ultimate “I’m too tired for this shit” move is to pull out parallel processing on it. Cause ugh. This ended up taking a few minutes on my machine.</p>
<pre class="r"><code>library(furrr) 

plan(multiprocess)

find_children &lt;- function(colour,df_rules){
  
  x &lt;- df_rules %&gt;% 
    filter(name == colour,!is.na(rule_qty))
  
  if(nrow(x)==0) return(tibble())
  
  x &lt;- x %&gt;% 
    mutate(rule_colour = map2(rule_colour,rule_qty,rep_len)) %&gt;% 
    unnest_longer(rule_colour)
  
  y &lt;- future_map_dfr(x$rule_colour,find_children,df_rules)
  
  bind_rows(x,y)
}

children &lt;- find_children(&quot;shiny gold&quot;,df_rules)</code></pre>
<pre class="r"><code>nrow(children)</code></pre>
<pre><code>## [1] 155802</code></pre>
</div>
